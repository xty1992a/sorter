!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Sorter",[],e):"object"==typeof exports?exports.Sorter=e():t.Sorter=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var r=document.createElement("div").style,o=function(){var t={webkit:"webkitTransform",Moz:"MozTransform",O:"OTransform",ms:"msTransform",standard:"transform"};for(var e in t)if(void 0!==r[t[e]])return e;return!1}();function i(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document.documentElement;if(s(t,e))return t;for(var r=t.parentNode,o=null;r;){if(r===n)return null;if(s(r,e))return r;r=r.parentNode}return o}function a(t,e){Object.keys(e).forEach((function(n){var r=e[n];["transform","transition"].includes(n)&&(n=function(t){return!1!==o&&("standard"===o?"transitionEnd"===t?"transitionend":t:o+t.charAt(0).toUpperCase()+t.substr(1))}(n)),t.style[n]=r}))}function s(t,e){return t.classList.contains(e)}function u(t,e){s(t,e)||(t.className=t.className+" "+e)}function l(t,e){s(t,e)&&(t.className=t.className.replace(e,"").replace(/\s{2,}/," "))}var c=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"].some((function(t){return navigator.userAgent.indexOf(t)>0})),d=!1;try{var f=Object.defineProperty({},"passive",{get:function(){d=!0}});window.addEventListener("test",null,f)}catch(t){console.log("not support passive")}var h=!(!c||!d)&&{passive:!1},p=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},v=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},m=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function g(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var b,x,w=window.Sorter;b="\n.sorter-item__on-drag-start{\n  box-shadow: 0 0 20px rgba(0,0,0,0.1);\n  transition: .2s;\n}\n.sorter-item__on-drag{\n  box-shadow: 0 0 20px rgba(0,0,0,0.1);\n}\n",(x=document.createElement("style")).innerText=b,document.head.appendChild(x);var $=function(){function t(e){y(this,t),Object.assign(this,e)}return m(t,[{key:"centerX",get:function(){return this.left+this.width/2}},{key:"centerY",get:function(){return this.top+this.height/2}},{key:"bottom",get:function(){return this.top+this.height}},{key:"right",get:function(){return this.left+this.width}}]),t}(),k=function(t){var e=t.parentNode.getBoundingClientRect(),n=t.getBoundingClientRect();return new $({width:n.width,height:n.height,top:n.top-e.top,left:n.left-e.left,index:t.dataset.hasOwnProperty("index")?+t.dataset.index:-1})},O=function(t,e){var n=t.x,r=t.y,o=e.left,i=e.top,a=e.right,s=e.bottom;return!(n<o||n>a||r<i||r>s)},S={down:c?"touchstart":"mousedown",move:c?"touchmove":"mousemove",up:c?"touchend":"mouseup"},_=function(){function t(){y(this,t),this.task={}}return m(t,[{key:"on",value:function(t,e){this.task[t]=e}},{key:"fire",value:function(t,e){this.task[t]&&this.task[t](e)}}]),t}(),T={change:!0,animateDuration:100,handlerClassName:"sorter-item",sorterItemClassName:"sorter-item",disableClassName:"sorter-disabled",onDragClassName:"sorter-item__on-drag",onDragStartClassName:"sorter-item__on-drag-start",pressDuration:0,vibrate:function(){}},I=function(t){function e(t,n){y(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.children=[],r.rectList=[],r.point=null,r.drag=null,r.dragIndex=-1,r.moveRect=null,r.destroyed=!1,r.down=function(t){if(!r.destroyed&&(i(t.target,r.$options.handlerClassName)&&!i(t.target,r.$options.disableClassName))){var e=i(t.target,r.$options.sorterItemClassName);if(e){r.fire("drag-down"),r.moved=!1,r.downTime=(new Date).getTime();var n=t.touches?t.touches[0]:t,o=n.clientX,s=n.clientY,l=e.getBoundingClientRect();r.point={posX:o-l.left,posY:s-l.top,startX:o,startY:s,moveX:o,moveY:s},r.__pressTimer=setTimeout((function(){r.fire("drag-start"),r.noticeDragStart(e),r.drag=e,r.dragStart=!0,r.cachedStyle=e.getAttribute("style");var t=r.moveRect=k(r.drag);r.dragIndex=+e.dataset.index,a(e,{zIndex:10,width:t.width+"px",height:t.height+"px",left:t.left+"px",top:t.top+"px",position:"absolute"}),u(e,r.$options.onDragClassName),r.insetHolder(t.index)}),r.$options.pressDuration)}}},r.move=function(t){if(clearTimeout(r.__pressTimer),!r.destroyed&&r.dragStart){l(r.drag,r.$options.onDragStartClassName),r.moved=!0,t.preventDefault();var e=t.touches?t.touches[0]:t,n=e.clientX,o=e.clientY,i=r.point,s=i.startX,u=o-i.startY,c=n-s;return r.moveRect.top=r.currentRect.top+u,r.moveRect.left=r.currentRect.left+c,a(r.drag,{transform:"translate3d("+c+"px,"+u+"px,0)"}),r.point.moveX=n,r.point.moveY=o,r.effectSibling(e),!1}},r.up=function(t){if(clearTimeout(r.__pressTimer),!r.destroyed&&r.dragStart){t.preventDefault();var e=r.hidIndex;r.dragStart=!1,r.point=null,r.$el.removeChild(r.$holderEl),r.$holderEl=null,r.drag.setAttribute("style",r.cachedStyle||""),l(r.drag,r.$options.onDragClassName);var n=(new Date).getTime()-r.downTime;if(r.moved&&n>100){var o={source:r.dragIndex,target:e};r.fire("drag-over",o),r.$options.change&&r.changeItem(o)}else r.fire("click-over",{index:r.dragIndex,rect:r.currentRect});return r.drag=null,r.moveRect=null,r.dragIndex=-1,!1}},r.$el=t,r.$options=p({},T,n),n.hasOwnProperty("vibrate")||(r.$options.vibrate=function(){if(r.$options.pressDuration)try{window.navigator.vibrate&&window.navigator.vibrate(100)}catch(t){console.log("vibrate error",t)}}),r.$init(),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),m(e,[{key:"noticeDragStart",value:function(t){var e=this;try{this.$options.vibrate&&this.$options.vibrate(),u(t,this.$options.onDragStartClassName),setTimeout((function(){l(t,e.$options.onDragStartClassName)}),200)}catch(t){console.error(t)}}},{key:"$init",value:function(){this.freshThreshold(),this.listen()}},{key:"changeItem",value:function(t){var e=t.source,n=t.target;if(e!==n){var r=this.$el,o=r.removeChild(r.children[e]);r.insertBefore(o,r.children[n]),this.freshThreshold()}}},{key:"sortList",value:function(t,e,n){var r=(t=[].concat(g(t))).splice(e,1),o=t.splice(0,n);return[].concat(g(o),g(r),g(t))}},{key:"freshThreshold",value:function(){var t=this;this.destroyed||(this.children=[].concat(g(this.$el.children)),this.children.forEach((function(e,n){u(e,t.$options.sorterItemClassName),e.dataset.index=n})),this.rectList=this.children.map((function(t){return k(t)})))}},{key:"fresh",value:function(){this.freshThreshold()}},{key:"listen",value:function(){this.$el.addEventListener(S.down,this.down,h),this.$el.addEventListener(S.move,this.move,h),document.addEventListener(S.up,this.up,h)}},{key:"unbindListener",value:function(){this.$el.removeEventListener(S.down,this.down),this.$el.removeEventListener(S.move,this.move),document.removeEventListener(S.up,this.up)}},{key:"effectSibling",value:function(t){var e=this.moveRect,n={x:e.centerX,y:e.centerY},r=this.rectList.findIndex((function(t){return O(n,t)}));if(-1!==r&&this.hidIndex!==r){this.hidIndex=r;var o=e.index;r===e.index||(o=r<e.index?r:r+1),this.animate(o)}}},{key:"animate",value:function(t){var e=this,n=this.$options.animateDuration;if(!(n<=0)){this.hasOwnProperty("lastInsetIndex")||(this.lastInsetIndex=this.moveRect.index);var r=function(t){var e=v(t,2),n=e[0],r=e[1];return n<r?[n,r]:[r,n]}([t,this.lastInsetIndex]),o=v(r,2),i=o[0],s=o[1];this.lastInsetIndex=t;var u=this.children.slice(i,s),l=u.map((function(t){return k(t)}));this.insetHolder(t),u.forEach((function(t,r){if(t!==e.drag){var o=k(t),i=l[r];a(t,{transform:"translate3d("+(i.left-o.left)+"px, "+(i.top-o.top)+"px, 0)"}),setTimeout((function(){a(t,{transition:n+"ms",transform:"translate3d(0,0,0)"}),setTimeout((function(){t.style.transition="",t.style.transform=""}),n)}),20)}}))}}},{key:"insetHolder",value:function(t){var e=this.getHolder();this.$el.insertBefore(e,this.$el.children[t])}},{key:"getHolder",value:function(){if(this.$holderEl)return this.$el.removeChild(this.$holderEl);var t=this.$holderEl=document.createElement("div"),e=this.moveRect,n=e.width,r=e.height;return t.className="sorter-holder",t.style.width=n+"px",t.style.height=r+"px",t.style.background="#f7f7f7",t}},{key:"destroy",value:function(){this.destroyed=!0,this.unbindListener()}},{key:"currentRect",get:function(){return this.rectList[this.dragIndex]||null}}],[{key:"noConflict",value:function(){return window.Sorter=w,e}}]),e}(_);e.default=I}]).default}));